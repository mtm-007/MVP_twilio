<!DOCTYPE html>
<html>
<head>
  <title>Web → Phone Test</title>
</head>
<body>
  <h1>Twilio Web → Phone Test</h1>
  <input id="phone" placeholder="+1234567890" />
  <button id="call">Call Phone</button>

  <script src="https://media.twiliocdn.com/sdk/js/voice/releases/1.14.0/twilio-voice.min.js"></script>
  <script>
    async function init() {
      // Get token from backend
      const res = await fetch('/token?identity=webUser');
      const data = await res.json();
      const token = data.token;

      const device = new Twilio.Device(token, {
        codecPreferences: ['opus', 'pcmu'],
        enableRingingState: true
      });

      device.on('ready', () => console.log('Twilio Device Ready'));
      device.on('error', err => console.error('Twilio Device Error', err));
      window.device = device;
    }

    init();

    document.getElementById('call').addEventListener('click', () => {
      const to = document.getElementById('phone').value;
      window.device.connect({ To: to });
    });
  </script>
</body>
</html>
